{% comment %}
 # -----------------------------------------------------------------------------
 # ~/_includes/themes/j1/layouts/content_generator_blog_archive.html
 # Liquid template to create the content portion for pages of type BLOG/ARCHIVE
 #
 # Product/Info:
 # https://jekyll.one
 #
 # Copyright (C) 2021 Juergen Adams
 #
 # J1 Template is licensed under the MIT License.
 # See: https://github.com/jekyll-one-org/J1 Template/blob/master/LICENSE
 # -----------------------------------------------------------------------------
 # Test data:
 #    liquid_var:      {{ liquid_var | debug }}
 #    page_path:       {{ page_path | debug }}
 #    page_url:        {{ page.url | remove_first:'page2/index.html' | debug }}
 #    navigator_path:  {{ navigator_path | debug }}
 # -----------------------------------------------------------------------------
{% endcomment %}

{% comment %} Liquid procedures
-------------------------------------------------------------------------------- {% endcomment %}
{% capture get_page_path %}themes/{{site.template.name}}/procedures/global/get_page_path.proc{% endcapture %}
{% capture collate_list %}themes/{{site.template.name}}/procedures/posts/collate_list.proc{% endcapture %}
{% capture collate_timeline %}themes/{{site.template.name}}/procedures/posts/collate_timeline.proc{% endcapture %}
{% capture create_navigator %}themes/{{site.template.name}}/procedures/posts/create_navigator.proc{% endcapture %}

{% comment %} Set config files
-------------------------------------------------------------------------------- {% endcomment %}
{% assign template_config               = site.data.j1_config %}
{% assign blocks                        = site.data.blocks %}
{% assign modules                       = site.data.modules %}
{% assign builder                       = site.data.builder_new %}
{% assign plugins                       = site.data.plugins %}

{% comment %} Set config data
-------------------------------------------------------------------------------- {% endcomment %}
{% assign blog_navigator_defaults       = builder.defaults.blog_navigator.defaults %}
{% assign blog_navigator_settings       = builder.blog_navigator.settings %}
{% assign paginator_defaults            = plugins.defaults.paginator.settings %}
{% assign paginator_settings            = plugins.paginator.settings %}

{% comment %} Set config options
-------------------------------------------------------------------------------- {% endcomment %}
{% assign blog_navigator_options        = blog_navigator_defaults | merge: blog_navigator_settings %}

{% comment %}
{% assign paginator_options             = paginator_defaults | merge: paginator_settings %}
{% endcomment %}


{% comment %} Variables
-------------------------------------------------------------------------------- {% endcomment %}
{% assign view_config_article_navigator = builder.blog_navigator.article_navigator %}
{% assign article_navigator_description = view_config_article_navigator.description %}
{% assign view_config_article_previewer = site.data.builder.blog_navigator.article_previewer %}
{% assign article_previewer_description = view_config_article_previewer.description %}

{% assign previewer                     = builder.blog_navigator.previewer %}
{% assign rtext                         = template_config.typography.rtext %}
{% assign page_rtext                    = page.rtext %}
{% assign page_rtext_size               = page.rtext_size %}

{% comment %}
{% assign paginate                      = paginator_options.pagination.enabled %}
{% endcomment %}


{% comment %} rtext|size detection
-------------------------------------------------------------------------------- {% endcomment %}
{% if rtext %}
  {% assign rtext_size = site.data.j1_config.typography.rtext_size %}
{% else %}
  {% assign rtext_size = 0 %}
{% endif %}


{% comment %} Main
-------------------------------------------------------------------------------- {% endcomment %}
<!-- [INFO   ] [j1.layout.content_generator_blog.html  ] [Begin content] -->
<main class="container r-text-{{rtext_size}} js-toc-content mb-5">

  {% comment %} Blog Navigator
  ------------------------------------------------------------------------ {% endcomment %}
  <!-- Content placed by layouts/content_generator_blog_archive.html -->
  <div id="blog_navigator">
    <div id="article_navigator">

      {% include {{get_page_path}} mode='absolute' %}
      {% capture navigator_path%}{{page_path}}{% endcapture %}
      {% capture archive_path %}{{navigator_path}}/archive{% endcapture %}

      {% capture date_view %}{{archive_path}}/dateview/{% endcapture %}
      {% capture category_view %}{{archive_path}}/categoryview/{% endcapture %}
      {% capture tag_view %}{{archive_path}}/tagview/{% endcapture %}
      {% capture all_view %}{{archive_path}}/{% endcapture %}

      <div class="navigator-headline">
        <nav class="paginator">
          <ul class="pagination raised-z0">
            <li class="page-item"><a class="page-link" href="{{category_view}}" title="View by Category">Nach Kategorie</a></li>
            <li class="page-item"><a class="page-link" href="{{date_view}}" title="View by Date">Nach Datum</a></li>
            <!-- li class="page-item"><a class="page-link" href="{{tag_view}}" title="View by Tag">By Tag</a></li -->
            <li class="page-item"><a class="page-link" href="{{all_view}}" title="View All">Alle Beiträge</a></li>
          </ul>
        </nav> <!-- end paginator -->
      </div> <!-- end navigator headline -->

    </div> <!-- end blog navigator -->

    <!-- Add Article Previewer if paginator is enabled -->
    <div id="article_previewer">

      <div class="previewer-headline">

        <div class="post-headline">
          <h2 id="previewer" class="mt-4">Vorschau</h2>
        </div>

        {% if paginator.total_pages > 1 %}
        <nav class="paginator mb-4">
          <ul class="pagination raised-z0">
            {% if paginator.previous_page %}
              <li class="page-item">
                  <a class="page-link" href="{{ paginator.previous_page_path }}#article_navigator">Neuere Beiträge</a>
              </li>
            {% else %}
                <li class="page-item disabled"><a href="#void" class="page-link">Erste Seite</a></li>
            {% endif %}

            {% if paginator.next_page %}
            <li class="page-item">
                <a class="page-link" href="{{ paginator.next_page_path }}#article_navigator">Ältere Beiträge</a>
            </li>
            {% else %}
                <li class="page-item disabled"><a href="#void" class="page-link">Letzte Seite</a></li>
            {% endif %}
          </ul>
        </nav>
        {% endif %}

        <div class="view-description mb-3">
          {{article_previewer_description}}
        </div>

      </div>

      <div id="article_preview">
        <!-- Previewer selected of type: {{previewer}}-->
        <div id="preview_content">
          {% assign posts_collate = paginator.posts %}
          {% case previewer %}
            {% when 'list' %}
              {% include {{collate_list}} header_title=page.header_title header_tagline=page.header_tagline items=posts_collate %}
            {% when 'calendar' %}
                {% include {{collate_calendar}} header_title=page.header_title header_tagline=page.header_tagline items=posts_collate %}
            {% when 'timeline' %}
              {% include {{collate_timeline}} items=posts_collate limit_excerpt=50 %}
            {% else %}
              {% include {{collate_list}} header_title=page.header_title header_tagline=page.header_tagline items=posts_collate %}
          {% endcase %}
        </div>
      </div>

    </div>
    <!-- end article previewer -->

  </div> <!-- end blog_navigator -->

  <!-- End Content placed by blog_archive_content.html -->
</main> <!-- end main -->

{% comment %} Calc|Write the Back URL
-------------------------------------------------------------------------------- {% endcomment %}
{% if site.permalink == 'none' %}
  {% capture browser_page_url %}{{page.url}}.html {% endcapture %}
{% else %}
  {% capture browser_page_url %}{{page.url}}{% endcapture %}
{% endif %}

<!-- [INFO   ] [j1.content_generator_blog_archive        ] [ {{page.title}} - save the current page to cookieUserState cookie: {{ browser_page_url }} ] -->
<script>
/* Manage the current page settings */
$(document).ready(function() {

  var dependencies_blog_generator = setInterval(function() {
    if ( j1.adapter.themer.getState() == 'finished' ) {
      // [INFO   ] [j1.content_generator_blog_archive        ] [ {{page.title}} - save the current page to cookieUserState cookie: {{ browser_page_url }} ]
      var cookie_names                = j1.getCookieNames();
      const user_state_cookie_name    = cookie_names.user_session;
      var user_state                  = j1.readCookie(user_state_cookie_name);
      var user_state_last_page        = "{{browser_page_url}}";
      user_state.last_page            = user_state_last_page;
      j1.writeCookie({
        name: user_state_cookie_name,
        data: user_state
      });
      // clear interval checking
      clearInterval(dependencies_blog_generator);
      }
    }, 25);
});
</script>
<!-- [INFO   ] [j1.layout.content_generator_blog.html  ] [ end content ] -->
