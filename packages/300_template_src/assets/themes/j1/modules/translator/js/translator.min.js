/*
 # -----------------------------------------------------------------------------
 # ~/assets/themes/j1/modules/translator/js/translator.min.js
 # Provides JS Core functions|API for J1 Module Translator
 #
 #  Product/Info:
 #  http://jekyll.one
 #
 #  Copyright (C) 2021 Juergen Adams
 #
 #  J1 Template is licensed under MIT License.
 #  See: https://github.com/jekyll-one/J1 Template/blob/master/LICENSE
 # -----------------------------------------------------------------------------
*/
"use strict";function Translator(d){var q=this;var v=log4javascript.getLogger("j1.core.translator");var m=new liteURL(window.location.href);var c=(m.protocol.includes("https"))?true:false;var r=false;var h;var t;this.props={contentURL:"/assets/data/translator",cookieName:"j1.user.state",cookieConsentName:"j1.user.consent",cookieStorageDays:365,cookieSameSite:"Strict",cookieSecure:c,translationEnabled:false,disableLanguageSelector:false,translatorName:"google",translationLanguages:"all",translationLanguage:"auto",translateAllPages:true,hideSuggestionBox:true,hidePoweredBy:true,hideTopFrame:true,dialogLanguage:"content",dialogLanguages:["en","de"],dialogContainerID:"translator-modal",xhrDataElement:"",postSelectionCallback:"",};for(var f in d){this.props[f]=d[f]}if(this.props.dialogLanguage.indexOf("-")!==-1){this.props.dialogLanguage=this.props.dialogLanguage.split("-")[0]}if(!this.props.dialogLanguages.includes(this.props.dialogLanguage)){this.props.dialogLanguage=this.props.dialogLanguages[0]}this.props.xhrDataElement=this.props.xhrDataElement+"-"+this.props.dialogLanguage;v.info("\ninitializing core module: started");v.info("\nstate: started");var g={set:function(y,A,D,z,B){var C=window.btoa(A);var w="";if(D){var x=new Date();x.setTime(x.getTime()+(D*24*60*60*1000));w="; expires="+x.toUTCString()}if(B){document.cookie=y+"="+(C||"")+w+"; Path=/; SameSite="+z+"; secure="+B+";"}else{document.cookie=y+"="+(C||"")+w+"; Path=/; SameSite="+z+";"}},get:function(x){var A=x+"=";var w=document.cookie.split(";");for(var y=0;y<w.length;y++){var C=w[y];while(C.charAt(0)===" "){C=C.substring(1,C.length)}if(C.indexOf(A)===0){var B=C.substring(A.length,C.length);var z=window.atob(B);return z}}return undefined}};var o={documentReady:function(w){if(document.readyState!=="loading"){w()}else{document.addEventListener("DOMContentLoaded",w)}}};function u(){var w={};var x=false;var y=0;var z=arguments.length;if(Object.prototype.toString.call(arguments[0])==="[object Boolean]"){x=arguments[0];y++}var B=function(C){for(var D in C){if(Object.prototype.hasOwnProperty.call(C,D)){if(x&&Object.prototype.toString.call(C[D])==="[object Object]"){w[D]=u(true,w[D],C[D])}else{w[D]=C[D]}}}};for(;y<z;y++){var A=arguments[y];B(A)}return w}function i(B,y){var w=Array.prototype.slice.call(arguments,2);var A=B.split(".");var z=A.pop();for(var x=0;x<A.length;x++){y=y[A[x]]}return y[z].apply(y,w)}function k(x){var w;var y=u({size:0,width:250,multiple:false,selectedIndex:1,enableAutoFilter:false,visibleRows:null,},x);w="#"+y.selector;$.ajax({url:y.url,dataType:"json",success:function(B){var A=[];if(q.props.translationLanguages.includes("all")){A=B[y.elm]}else{for(var z=0;z<B[y.elm].length;z++){if(q.props.translationLanguages.includes(B[y.elm][z].value)){A.push(B[y.elm][z])}}}if(y.visibleRows>A.length){y.visibleRows=A.length}MsDropdown.make(w,{byJson:{data:A,name:y.name,size:y.size,width:y.width,multiple:y.multiple,},enableAutoFilter:y.enableAutoFilter,visibleRows:y.visibleRows,})},error:function(z,B,A){v.error("\nfailed to retrieve JSON data from: "+y.url)}})}function e(){v.info("\nload consent modal");q.modal=document.createElement("div");q.modal.id=q.props.dialogContainerID;q.modal.setAttribute("class","modal fade");q.modal.setAttribute("tabindex","-1");q.modal.setAttribute("role","dialog");q.modal.setAttribute("aria-labelledby",q.props.dialogContainerID);document.body.append(q.modal);q.$modal=$(q.modal);q.$modal.on("show.bs.modal",function(){var x;var y;v.info("\nshow.bs.modal: entered");$.when(k({url:"/assets/data/iso-639-language-codes-flags.json",elm:"iso-639-languages",selector:"dropdownJSON",width:400,visibleRows:8,})).then(function(z){v.info("\ncreating msDropdown from JSON data: finished")})});q.$modal.on("shown.bs.modal",function(){var x;var y;y=setInterval(function(){if(typeof document.getElementById("dropdownJSON").msDropdown!=="undefined"){x=document.getElementById("dropdownJSON").msDropdown;if(!x.length){v.error("\nno msDropdown found in translation dialog");q.$modal.hide()}else{if(q.props.translationLanguage==="auto"){h=navigator.language||navigator.userLanguage;t=h.split("-")[0]}else{t=q.props.translationLanguage}x.selectedIndex=$("#dropdownJSON option[value="+t+"]").index();if(q.props.disableLanguageSelector){x.disabled=true}$("#dropdownJSON").show();$("body").addClass("stop-scrolling");v.info("\nmsDropdown successfully loaded in translation dialog");clearInterval(y)}}},25)});q.$modal.on("hidden.bs.modal",function(){$("body").removeClass("stop-scrolling");i(q.props.postSelectionCallback,window)});var w=q.props.contentURL+"/index.html";$.get(w).done(function(x){v.info("\nloading consent modal: successfully");q.modal.innerHTML=x;q.modal.innerHTML=$("#"+q.props.xhrDataElement).eq(0).html();$(q.modal).modal({backdrop:"static",keyboard:false});q.$buttonDoNotAgree=$("#translator-buttonDoNotAgree");q.$buttonAgree=$("#translator-buttonAgree");q.$buttonSave=$("#translator-buttonSave");q.$buttonAgreeAll=$("#translator-buttonAgreeAll");v.info("\nload/initialze options from cookie");l();j();$("#google-options").on("hide.bs.collapse",function(){r=false;l()}).on("show.bs.collapse",function(){r=true;l()});v.info("\ninitialze button event handler");q.$buttonDoNotAgree.click(function(){b()});q.$buttonAgree.click(function(){p()});q.$buttonSave.click(function(){$("#google-options").collapse("hide");s();j()});q.$buttonAgreeAll.click(function(){$("#google-options").collapse("hide");p()})}).fail(function(){v.error("\nloading translator dialog (modal): failed");v.warn("\nprobably no|wrong `contentURL` set")})}function n(){o.documentReady(function(){q.modal=document.getElementById(q.props.dialogContainerID);if(!q.modal){e()}else{q.$modal.modal("show")}}.bind(this))}function j(){var y=q.getSettings();if(y){for(var x in y){var w=q.$modal.find("#google-options .translator-option[data-name="+x+'] input[type="checkbox"]');w.prop("checked",y[x])}}}function l(){if(r){q.$buttonDoNotAgree.hide();q.$buttonAgree.hide();q.$buttonSave.show();q.$buttonAgreeAll.show()}else{q.$buttonDoNotAgree.show();q.$buttonAgree.show();q.$buttonSave.hide();q.$buttonAgreeAll.hide()}}function a(x){var w=q.$modal.find("#google-options .translator-option");var z={};for(var A=0;A<w.length;A++){var C=w[A];var y=C.getAttribute("data-name");if(y==="necessary"){z[y]=true}else{if(x===undefined){var B=$(C).find('input[type="checkbox"]');z[y]=B.prop("checked")}else{z[y]=!!x}}}return z}function p(){var x=a(true);var w={};w=JSON.parse(g.get(q.props.cookieConsentName));w.analysis=x.analysis;w.personalization=x.personalization;g.set(q.props.cookieConsentName,JSON.stringify(w),q.props.cookieStorageDays,q.props.sameSite,q.props.secure);g.set(q.props.cookieName,JSON.stringify(x),q.props.cookieStorageDays,q.props.sameSite,q.props.secure);q.$modal.modal("hide")}function b(){var w=a();w.translationEnabled=false;g.set(q.props.cookieName,JSON.stringify(w),q.props.cookieStorageDays,q.props.sameSite,q.props.secure);q.$modal.modal("hide")}function s(){var x;var w={};x=a();w=JSON.parse(g.get(q.props.cookieConsentName));w.analysis=x.analysis;w.personalization=x.personalization;g.set(q.props.cookieConsentName,JSON.stringify(w),q.props.cookieStorageDays,q.props.sameSite,q.props.secure);g.set(q.props.cookieName,JSON.stringify(a()),q.props.cookieStorageDays,q.props.sameSite,q.props.secure);q.$modal.modal("hide")}this.loadDialog=function(){e()};this.showDialog=function(){n()};this.getSettings=function(x){var w=g.get(q.props.cookieName);if(w){var y=JSON.parse(g.get(q.props.cookieName));if(x===undefined){return y}else{if(y){return y[x]}else{return false}}}else{return undefined}};v.info("\ninitializing core module finished");v.info("\nstate: finished")};
