/*
 # -----------------------------------------------------------------------------
 # ~/assets/themes/j1/modules/translator/js/translator.js
 # Provides JS Core functions|API for J1 Module Translator
 #
 #  Product/Info:
 #  http://jekyll.one
 #
 #  Copyright (C) 2021 Juergen Adams
 #
 #  J1 Template is licensed under MIT License.
 #  See: https://github.com/jekyll-one/J1 Template/blob/master/LICENSE
 # -----------------------------------------------------------------------------
*/
function Translator(d){var o=this;var t=log4javascript.getLogger("j1.core.translator");var k=new liteURL(window.location.href);var c=(k.protocol.includes("https"))?true:false;var p=false;var g;var r;this.props={contentURL:"/assets/data/translator",cookieName:"j1.user.state",cookieConsentName:"j1.user.consent",cookieStorageDays:365,cookieSameSite:"Strict",cookieSecure:c,translationEnabled:false,disableLanguageSelector:false,translatorName:"google",translationLanguages:"all",translationLanguage:"auto",translateAllPages:true,hideSuggestionBox:true,hidePoweredBy:true,hideTopFrame:true,dialogLanguage:"content",dialogLanguages:["en","de"],dialogContainerID:"translator-modal",xhrDataElement:"",postSelectionCallback:undefined,};for(var e in d){this.props[e]=d[e]}if(this.props.dialogLanguage.indexOf("-")!==-1){this.props.dialogLanguage=this.props.dialogLanguage.split("-")[0]}if(!this.props.dialogLanguages.includes(this.props.dialogLanguage)){this.props.dialogLanguage=this.props.dialogLanguages[0]}this.props.xhrDataElement=this.props.xhrDataElement+"-"+this.props.dialogLanguage;t.info("\ninitializing core module: started");t.info("\nstate: started");var f={set:function(w,y,B,x,z){var A=window.btoa(y);var u="";if(B){var v=new Date();v.setTime(v.getTime()+(B*24*60*60*1000));u="; expires="+v.toUTCString()}if(z){document.cookie=w+"="+(A||"")+u+"; Path=/; SameSite="+x+"; secure="+z+";"}else{document.cookie=w+"="+(A||"")+u+"; Path=/; SameSite="+x+";"}},get:function(v){var y=v+"=";var u=document.cookie.split(";");for(var w=0;w<u.length;w++){var A=u[w];while(A.charAt(0)===" "){A=A.substring(1,A.length)}if(A.indexOf(y)===0){var z=A.substring(y.length,A.length);var x=window.atob(z);return x}}return undefined}};var m={documentReady:function(u){if(document.readyState!=="loading"){u()}else{document.addEventListener("DOMContentLoaded",u)}}};function s(){var u={};var v=false;var w=0;var x=arguments.length;if(Object.prototype.toString.call(arguments[0])==="[object Boolean]"){v=arguments[0];w++}var z=function(A){for(var B in A){if(Object.prototype.hasOwnProperty.call(A,B)){if(v&&Object.prototype.toString.call(A[B])==="[object Object]"){u[B]=s(true,u[B],A[B])}else{u[B]=A[B]}}}};for(;w<x;w++){var y=arguments[w];z(y)}return u}function i(v){var u;var w=s({size:0,width:250,multiple:false,selectedIndex:1,enableAutoFilter:false,visibleRows:null,},v);u="#"+w.selector;$.ajax({url:w.url,dataType:"json",success:function(z){var y=[];if(o.props.translationLanguages.includes("all")){y=z[w.elm]}else{for(var x=0;x<z[w.elm].length;x++){if(o.props.translationLanguages.includes(z[w.elm][x].value)){y.push(z[w.elm][x])}}}if(w.visibleRows>y.length){w.visibleRows=y.length}MsDropdown.make(u,{byJson:{data:y,name:w.name,size:w.size,width:w.width,multiple:w.multiple,},enableAutoFilter:w.enableAutoFilter,visibleRows:w.visibleRows,})},error:function(x,z,y){t.error("\nfailed to retrieve JSON data from: "+w.url)}})}function l(){m.documentReady(function(){o.modal=document.getElementById(o.props.dialogContainerID);if(!o.modal){t.info("\nload consent modal");o.modal=document.createElement("div");o.modal.id=o.props.dialogContainerID;o.modal.setAttribute("class","modal fade");o.modal.setAttribute("tabindex","-1");o.modal.setAttribute("role","dialog");o.modal.setAttribute("aria-labelledby",o.props.dialogContainerID);document.body.append(o.modal);o.$modal=$(o.modal);o.$modal.on("show.bs.modal",function(){var v;var w;t.info("\nshow.bs.modal: entered");$.when(i({url:"/assets/data/msdropdown.json",elm:"googleLanguages",selector:"dropdownJSON",width:300,visibleRows:4,})).then(function(x){t.info("\ncreate msDropdown from JSON: finished");v=document.getElementById("dropdownJSON").msDropdown;if(o.props.translationLanguage==="auto"){g=navigator.language||navigator.userLanguage;r=g.split("-")[0]}w=$("#dropdownJSON option[value="+r+"]").index();v.selectedIndex=w})});o.$modal.on("shown.bs.modal",function(){var w=document.getElementById("dropdownJSON").msDropdown;var A=w.length;var y;var z;var x;var B;var v;if(o.props.disableLanguageSelector){w.disabled=true}$("#dropdownJSON").show();$("body").addClass("stop-scrolling")});o.$modal.on("hidden.bs.modal",function(){$("body").removeClass("stop-scrolling");o.props.postSelectionCallback()});var u=o.props.contentURL+"/index.html";$.get(u).done(function(v){t.info("\nloading consent modal: successfully");o.modal.innerHTML=v;o.modal.innerHTML=$("#"+o.props.xhrDataElement).eq(0).html();$(o.modal).modal({backdrop:"static",keyboard:false});o.$buttonDoNotAgree=$("#translator-buttonDoNotAgree");o.$buttonAgree=$("#translator-buttonAgree");o.$buttonSave=$("#translator-buttonSave");o.$buttonAgreeAll=$("#translator-buttonAgreeAll");t.info("\nload/initialze options from cookie");j();h();$("#google-options").on("hide.bs.collapse",function(){p=false;j()}).on("show.bs.collapse",function(){p=true;j()});t.info("\ninitialze button event handler");o.$buttonDoNotAgree.click(function(){b()});o.$buttonAgree.click(function(){n()});o.$buttonSave.click(function(){$("#google-options").collapse("hide");q();h()});o.$buttonAgreeAll.click(function(){$("#google-options").collapse("hide");n()})}).fail(function(){t.error("\nloading translator dialog (modal): failed");t.warn("\nprobably no|wrong `contentURL` set")})}else{o.$modal.modal("show")}}.bind(this))}function h(){var w=o.getSettings();if(w){for(var v in w){var u=o.$modal.find("#google-options .translator-option[data-name="+v+'] input[type="checkbox"]');u.prop("checked",w[v])}}}function j(){if(p){o.$buttonDoNotAgree.hide();o.$buttonAgree.hide();o.$buttonSave.show();o.$buttonAgreeAll.show()}else{o.$buttonDoNotAgree.show();o.$buttonAgree.show();o.$buttonSave.hide();o.$buttonAgreeAll.hide()}}function a(v){var u=o.$modal.find("#google-options .translator-option");var x={};for(var y=0;y<u.length;y++){var A=u[y];var w=A.getAttribute("data-name");if(w==="necessary"){x[w]=true}else{if(v===undefined){var z=$(A).find('input[type="checkbox"]');x[w]=z.prop("checked")}else{x[w]=!!v}}}return x}function n(){var v;var u={};v=a();u=JSON.parse(f.get(o.props.cookieConsentName));u.analysis=v.analysis;u.personalization=v.personalization;f.set(o.props.cookieConsentName,JSON.stringify(u),o.props.cookieStorageDays,o.props.sameSite,o.props.secure);f.set(o.props.cookieName,JSON.stringify(a(true)),o.props.cookieStorageDays,o.props.sameSite,o.props.secure);o.$modal.modal("hide")}function b(){var u=a();u.translationEnabled=false;f.set(o.props.cookieName,JSON.stringify(u),o.props.cookieStorageDays,o.props.sameSite,o.props.secure);o.$modal.modal("hide")}function q(){var v;var u={};v=a();u=JSON.parse(f.get(o.props.cookieConsentName));u.analysis=v.analysis;u.personalization=v.personalization;f.set(o.props.cookieConsentName,JSON.stringify(u),o.props.cookieStorageDays,o.props.sameSite,o.props.secure);f.set(o.props.cookieName,JSON.stringify(a()),o.props.cookieStorageDays,o.props.sameSite,o.props.secure);o.$modal.modal("hide")}this.showDialog=function(){l()};this.getSettings=function(v){var u=f.get(o.props.cookieName);if(u){var w=JSON.parse(f.get(o.props.cookieName));if(v===undefined){return w}else{if(w){return w[v]}else{return false}}}else{return undefined}};t.info("\ninitializing core module finished");t.info("\nstate: finished")};
