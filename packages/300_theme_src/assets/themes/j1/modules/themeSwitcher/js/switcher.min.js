/*
 # -----------------------------------------------------------------------------
 # ~/assets/themes/j1/modules/bsThemeSwitcher/js/switcher.js
 # Provides Javascript functions for Bootstrap ThemeSwitcher
 #
 # Product/Info:
 # https://jekyll.one
 # https://github.com/jguadagno/bootstrapThemeSwitcher
 #
 # Copyright (C) 2023, 2024 Juergen Adams
 # Copyright (C) 2014 Joseph Guadagno
 #
 # J1 Template is licensed under the MIT License.
 # See: https://github.com/jekyll-one-org/j1-template/blob/main/LICENSE.md
 # Bootstrap Theme Switcher is licensed under the MIT License.
 # See: https://github.com/jguadagno/bootstrapThemeSwitcher
 # -----------------------------------------------------------------------------
 # NOTE: This modules is MODIFIED to be used with MobileMenu (mmenuLight).
 #       The original version cannot be used with J1 for theme menu creation!
 # -----------------------------------------------------------------------------
*/

"use strict";!function(e,t,o,s){var i,n=j1.getCookieNames(),r=j1.findCookie("_ga"),a=j1.findCookie("j1"),h=new liteURL(t.location.href),c=h.hostname,l=(c.substring(c.lastIndexOf(".",c.lastIndexOf(".")-1)+1),!!h.protocol.includes("https")),m=log4javascript.getLogger("j1.themes.switcher"),d=function(t,o){return this.$element=e(t),this.settings=e.extend({},e.fn.ThemeSwitcher.defaults,o),this.themesList=[],this.getThemes(),this};d.prototype={clear:function(){return m.debug("\nThemeSwitcher.clear"),this.$element.each(function(){this.$element.empty()})},update:function(){m.debug("\nThemeSwitcher.update"),this.getThemes()},checkStyleSheetByName:function(e){for(var t=!1,s=new RegExp("/"+e+"/","i"),i=0;i<o.styleSheets.length;i++)if(s.test(o.styleSheets[i].href)){t=!0;break}return t},switchTheme:function(t,o){var s=e(this),h=e.extend({},e.fn.ThemeSwitcher.defaults,s.data("ThemeSwitcher")),c=(h.cssThemeLink,h.debug);this.settings.includeBootswatch;if(j1.existsCookie(n.user_state)?(m.info("\ncookie found: "+n.user_state),i=j1.readCookie(n.user_state)):(m.error("\ncookie not found: "+n.user_state),m.info("\nj1 cookies found:"+a.length),a.forEach(function(e){console.log("j1.core.switcher: "+e)}),m.info("\nga cookies found:"+r.length),r.forEach(function(e){console.log("j1.core.switcher: "+e)})),i.theme_name,i.theme_css,void 0===o&&(o=this.settings.defaultCssFile),void 0===t&&(t=o),h.saveToCookie){if("undefined"==typeof Cookies)return"true"===c&&m.error("\ncookies library not present"),!1;i.theme_name=t,i.theme_css=o,i.theme_name.includes("Uno")||"Bootstrap"==i.theme_name?(i.theme_author="J1 Team",i.theme_author_url="https://jekyll.one/"):(i.theme_author="Bootswatch",i.theme_author_url="https://bootswatch.com/"),m.info("\nwrite to cookie : "+n.user_state),j1.writeCookie({name:n.user_state,data:i,secure:l,expires:365}),location.reload(!0)}else m.info("\nwrite to cookie : disabled"),m.warn("\nselected theme not activated: "+t)},loadThemeFromCookie:function(t){if("undefined"==typeof Cookies)return m.error("\ncookies library not present"),!1;e.extend({},e.fn.ThemeSwitcher.defaults,t);j1.existsCookie(n.user_state)?(m.info("\ncookie found: "+n.user_state),i=j1.readCookie(n.user_state)):(m.error("\ncookie not found: "+n.user_state),m.info("\nj1 cookies found:"+a.length),a.forEach(function(e){console.log("j1.core.switcher: "+e)}),m.info("\nga cookies found:"+r.length),r.forEach(function(e){console.log("j1.core.switcher: "+e)}));var o=i.theme_name,s=i.theme_css;this.switchTheme(o,s)},addTheme:function(e,t,o,s){void 0===o&&(o=0),void 0===s&&(s=0),this.themesList.splice(o,s,{name:e,css:t}),this.addThemesToControl()},addThemesToControl:function(){if(void 0===this.$element)return m.error("\nbootstrapThemeSelector|addThemesToControl: Element is undefined"),!1;if(void 0===this.themesList)return m.error("\nbootstrapThemeSelector|addThemesToControl: Themes is undefined"),!1;if(this.settings.excludeBootswatch){var t;-1!==this.settings.excludeBootswatch.indexOf(",")?t=this.settings.excludeBootswatch.replace(/ /g,"").split(","):(t=[]).push(this.settings.excludeBootswatch);var o=this.themesList;e.each(o,function(s,i){i&&i.name&&-1!==e.inArray(i.name,t)&&o.splice(s,1)}),this.themesList=o}var s=this;if(this.$element.is("ul")){var h,c=e(this),l=e.extend({},e.fn.ThemeSwitcher.defaults,c.data("ThemeSwitcher")),d=(l.cssThemeLink,l.debug);j1.existsCookie(n.user_state)?(m.info("\nuser state cookie found"),i=j1.readCookie(n.user_state)):(m.error("\nuser state NOT cookie found"),m.info("\nj1 cookies found:"+a.length),a.forEach(function(e){console.log("j1.core.switcher: "+e)}),m.info("\nga cookies found:"+r.length),r.forEach(function(e){console.log("j1.core.switcher: "+e)})),h=i.theme_name,"true"===d&&m.info("\nbootstrapThemeSelector: UL element selected"),this.$element.empty();var u="";e.each(this.themesList,function(t,o){u=s.$element[0].id.includes("mmenu")?"mmenu-item":"dropdown-item",o.name===h&&(u=s.$element[0].id.includes("mmenu")?"mmenu-item active":"dropdown-item active");var i=e("<li />").attr("class",u).append('<a class="link-no-decoration" href="#"><i class="mdib mdib-view-quilt mdib-18px mr-2" style="color: #9E9E9E"></i>'+o.name+"</a>").on("click",function(){l.loadFromBootswatch?s.switchTheme(o.name,o.css):s.switchTheme(o.name,o.cssCdn),e(this).parent().find("li").removeClass("active"),e(this).addClass("active")});s.$element.append(i)})}else if(this.$element.is("select")){var f;m.info("\nbootstrapThemeSelector: SELECT element selected"),this.$element.empty(),e.each(this.themesList,function(e,t){f=null,t.name===h&&(f="selected"),l.loadFromBootswatch?s.$element.append("<option "+f+" value='"+t.css+"'>"+t.name+"</option>"):s.$element.append("<option "+f+" value='"+t.cssCdn+"'>"+t.name+"</option>")}),this.$element.on("change",function(){var t=e("option:selected",this);s.switchTheme(t.text(),t.val())})}else m.info("\nbootstrapThemeSelector: no UL or SELECT element found"),m.error("\nbootstrapThemeSelector: failed")},getThemes:function(){var t=this;null!==this.settings.localFeed&&""!==this.settings.localFeed?e.ajax({url:this.settings.localFeed,dataType:"json",success:function(e){t.themesList=e.themes,t.addThemesToControl()},error:function(e,o,s){m.error("\nfailed to retrieve the local feed from: '"+t.settings.localFeed+"'")}}):e.ajax({url:this.settings.bootswatchApiUrl+"/"+this.settings.bootswatchApiVersion+".json",dataType:"json",success:function(e){if(void 0===e.themes)return null;t.themesList=e.themes,t.themesList.splice(0,0,{name:"default",css:t.settings.defaultCssFile}),t.addThemesToControl()}})},themes:function(e){if(void 0===e)return this.themesList;this.themesList=e}},e.fn.ThemeSwitcher=function(t){var o,s=Array.prototype.slice.call(arguments,1),i=e(this),n=i.data("ThemeSwitcher"),r="object"==typeof t&&t;return n||i.data("ThemeSwitcher",n=new d(this,r)),"string"==typeof t&&(o=n[t].apply(n,s)),void 0===o?i:o},e.fn.ThemeSwitcher.defaults={debug:!1,saveToCookie:!0,cssThemeLink:"bootstrapTheme",cookieThemeName:"bootstrapTheme.name",cookieThemeCss:"boostrapTheme.css",cookieExpiration:365,cookiePath:"/",defaultCssFile:"https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css",bootswatchApiUrl:"https://bootswatch.com/api/",bootswatchApiVersion:"5",loadFromBootswatch:!0,localFeed:"",excludeBootswatch:""},e.fn.ThemeSwitcher.Constructor=d}(jQuery,window,document);
