/*
 # -----------------------------------------------------------------------------
 # ~/assets/themes/j1/modules/videojs/js/wt/wistia.min.js
 # Provides Wistia Playback Technology (Tech) for Video.js V8 and newer
 # See: https://github.com/edly-io/videojs-wistia
 #
 #  Product/Info:
 #  http://jekyll.one
 #
 # Copyright (C) 2020-2021 Zia Fazal
 # Copyright (C) 2021 Edly by Arbisoft
 # Copyright (C) 2023, 2024 Juergen Adams
 #
 #  videojs-wistia is licensed under MIT License.
 #  See: https://github.com/edly-io/videojs-wistia/blob/master/LICENSE
 #  J1 Theme is licensed under MIT License.
 #  See: https://github.com/jekyll-one-org/j1-template/blob/main/LICENSE
 # -----------------------------------------------------------------------------
*/

!function(e,t){if("object"==typeof exports&&"undefined"!=typeof module){var i=require("video.js");module.exports=t(i.default||i)}else"function"==typeof define&&define.amd?define(["videojs"],(function(i){return e.Wistia=t(i)})):e.Wistia=t(e.videojs)}(this,(function(e){"use strict";var t,i,s=log4javascript.getLogger("videoJS.plugin.wistia"),a=e.browser.IS_IOS||e.browser.IS_NATIVE_ANDROID,r=e.getTech("Tech");class o extends r{constructor(e,t){super(e,t),this.setPoster(e.poster),this.setSrc(this.options_.source,!0),this.setTimeout(function(){this.el_&&(this.el_.parentNode.className+=" vjs-wistia",a&&(this.el_.parentNode.className+=" vjs-wistia-mobile"),o.isApiReady?this.initWistiaPlayer():o.apiReadyQueue.push(this))}.bind(this))}dispose(){if(this.wistiaPlayer)this.wistiaPlayer&&(this.wistiaPlayer.pause(),this.wistiaPlayer.remove());else{var e=o.apiReadyQueue.indexOf(this);-1!==e&&o.apiReadyQueue.splice(e,1)}this.wistiaPlayer=null,this.el_.parentNode.className=this.el_.parentNode.className.replace(" vjs-wistia","").replace(" vjs-wistia-mobile",""),this.el_.parentNode.removeChild(this.el_)}createEl(){var e=document.createElement("div");e.setAttribute("id",this.options_.techId),e.setAttribute("style","width:100%;height:100%;top:0;left:0;position:absolute"),e.setAttribute("class","vjs-tech "+this.options_.playback_css_class);var t=document.createElement("div");return t.appendChild(e),t}initWistiaPlayer(){var e={controlsVisibleOnLoad:!1,chromeless:!0,playbar:!1,playButton:!1,settingsControl:!1,smallPlayButton:!1,volumeControl:!1,videoFoam:!1,fullscreenButton:!1,preload:!0,doNotTrack:!0,autoPlay:!1};void 0!==this.options_.videoFoam&&(e.videoFoam=this.options_.videoFoam),void 0!==this.options_.source&&(this.videoId=this.options_.source.src),void 0!==this.options_.autoplay&&(e.autoPlay=this.options_.autoplay,e.muted=this.options_.autoplay);var t=this;window._wq=window._wq||[],_wq.push({id:this.videoId,options:e,onReady:function(e){t.wistiaPlayer=e,t.onPlayerReady(),t.wistiaPlayer.bind("end",t.onPlaybackEnded.bind(t))}}),s.debug("\ncreated player ID on: "+this.videoId)}onPlayerReady(){var e;document.getElementById(this.options_.playerId+"_wistia_api").addEventListener("click",(t=>{e=this.wistiaPlayer.state(),t.preventDefault(),t.stopPropagation(),"beforeplay"===e&&(this.wistiaPlayer.play(),this.trigger("play"),s.debug("\ntriggered play on state: "+e)),"playing"===e&&this.trigger("play"),"paused"===e&&this.trigger("pause")})),this.options_.muted&&this.wistiaPlayer.mute(),this.playerReady_=!0,this.triggerReady(),this.playOnReady&&this.play()}onPlaybackEnded(){this.trigger("ended")}src(e){return e&&this.setSrc({src:e}),this.source}setSrc(e){e&&e.src&&(delete this.errorName,this.source=e,this.options_.autoplay&&!a&&(this.isReady_?this.play():this.playOnReady=!0))}autoplay(){return this.options_.autoplay}setAutoplay(e){this.options_.autoplay=e}loop(){return this.options_.loop}setLoop(e){this.options_.loop=e}play(){this.videoId&&(this.isReady_?(this.wistiaPlayer.play(),this.trigger("play")):(this.trigger("waiting"),this.playOnReady=!0))}pause(){this.wistiaPlayer&&(this.wistiaPlayer.pause(),this.trigger("pause"))}paused(){if(this.wistiaPlayer)return"paused"===this.wistiaPlayer.state()||"ended"===this.wistiaPlayer.state()}currentTime(){if(this.wistiaPlayer)return this.wistiaPlayer.time()}setCurrentTime(e){this.wistiaPlayer&&this.wistiaPlayer.time(e)}duration(){if(this.wistiaPlayer)return this.wistiaPlayer.duration()}currentSrc(){return this.source&&this.source.src}ended(){if(this.wistiaPlayer)return"ended"===this.wistiaPlayer.state()}volume(){if(this.wistiaPlayer)return this.wistiaPlayer.volume()}setVolume(e){this.wistiaPlayer&&(this.wistiaPlayer.volume(e),this.trigger("volumechange"))}muted(){if(this.wistiaPlayer)return this.wistiaPlayer.isMuted()}setMuted(e){this.wistiaPlayer&&(!0===e?this.wistiaPlayer.mute():this.wistiaPlayer.unmute(),this.trigger("volumechange"))}supportsFullScreen(){return!0}}function n(){o.isApiReady=!0,s.debug("\nAPI loaded successfully");for(var e=0;e<o.apiReadyQueue.length;++e)o.apiReadyQueue[e].initWistiaPlayer();s.debug("\ncreated all players from queue: #"+e),i=Date.now(),s.debug("\ninitializing plugin: finished"),s.debug("\nplugin initializing time: "+(i-t)+"ms")}o.isSupported=function(){return!0},o.canPlaySource=function(e){return o.canPlayType(e.type)},o.canPlayType=function(e){return"video/wistia"===e},o.apiReadyQueue=[];var l=setInterval((()=>{var i,a,r,o,d,u,h,p,y="block"===$("#content").css("display"),c="finished"===j1.getState(),g="finished"==j1.adapter.attic.getState();c&&y&&g&&(t=Date.now(),s.debug("\ninitializing plugin: started"),s.debug("\nversion of videoJS detected: "+e.VERSION),o="//fast.wistia.com/assets/external/E-v1.js",d=n,u=!1,h=document.createElement("script"),(p=document.getElementsByTagName("script")[0])&&(p.parentNode.insertBefore(h,p),h.onload=function(){u||(u=!0,d())},h.onreadystatechange=function(){u||"complete"!==this.readyState&&"loaded"!==this.readyState||(u=!0,d())},h.src=o),i=".vjs-wistia-mobile .vjs-big-play-button {display: none;}",a=document.head||document.getElementsByTagName("head")[0],(r=document.createElement("style")).type="text/css",r.styleSheet?r.styleSheet.cssText=i:r.appendChild(document.createTextNode(i)),s.debug("\nadded additional CSS styles"),a.appendChild(r),clearInterval(l))}),10);void 0!==e.registerTech?e.registerTech("Wistia",o):console.error("\ninvalid version of videoJS detected: "+e.VERSION)}));
