/*
 # -----------------------------------------------------------------------------
 # ~/assets/themes/j1/modules/videojs/js/vimeo/vimeo.min.js
 # Provides Vimeo Playback Technology (Tech) for Video.js V8 and newer
 #
 #  Product/Info:
 #  http://jekyll.one
 #
 #  Copyright (C) 2023, 2024 Juergen Adams
 #
 #  J1 Theme is licensed under MIT License.
 #  See: https://github.com/jekyll-one/J1 Theme/blob/master/LICENSE
 # -----------------------------------------------------------------------------
*/


!function(e,t){if("object"==typeof exports&&"undefined"!=typeof module){var i=require("video.js");module.exports=t(i.default||i)}else"function"==typeof define&&define.amd?define(["videojs"],(function(i){return e.Vimeo=t(i)})):e.Vimeo=t(e.videojs)}(this,(function(e){"use strict";var t,i,s,a,r=log4javascript.getLogger("videoJS.plugin.vimeo"),o=e.browser.IS_IOS||e.browser.IS_ANDROID,n=e.getTech("Tech"),l=!1;class d extends n{constructor(e,t){super(e,t),this.setPoster(e.poster);var i=this;setTimeout(function(){this.el_&&(this.el_.parentNode.className+=" vjs-vimeo",o&&(this.el_.parentNode.className+=" vjs-vimeo-mobile"),d.isSdkReady?i.initVMPlayer():d.sdkReadyQueue.push(i))}.bind(this))}initVMPlayer(){var e={url:this.options_.source.src,byline:!1,controls:!1,portrait:!1,title:!1,pip:!1,vimeo_logo:!1};e.controls=!0,this.options_.autoplay&&(e.autoplay=!0),this.options_.height&&(e.height=this.options_.height),this.options_.width&&(e.width=this.options_.width),this.options_.maxheight&&(e.maxheight=this.options_.maxheight),this.options_.maxwidth&&(e.maxwidth=this.options_.maxwidth),this.options_.loop&&(e.loop=this.options_.loop),this.options_.color&&(e.color=this.options_.color.replace(/^#/,"")),this.vmPlayer=new VM.Player(this.el(),e),this.initVimeoState();["play","playing","pause","ended","loaded","timeupdate","progress","seeking","seeked","ready"].forEach((e=>{this.vmPlayer.on(e,(t=>{this._vimeoState.progress.duration!==t.duration&&this.trigger("durationchange"),this._vimeoState.progress=t,this.trigger(e)})),this.vmPlayer.on(e,(e=>{this.vmPlayer.getVideoEmbedCode().then((e=>{})).catch((e=>{console.err("Vimeo API: an error occurred")}))})),this.vmPlayer.on(e,(t=>{this._vimeoState.progress.duration!==progress.duration&&this.trigger("durationchange"),this._vimeoState.progress=progress,this.trigger(e)})),this.vmPlayer.on("pause",(()=>this._vimeoState.playing=!1)),this.vmPlayer.on("play",(()=>{this._vimeoState.playing=!0,this._vimeoState.ended=!1}))})),this.vmPlayer.on("ended",(()=>{this._vimeoState.playing=!1,this._vimeoState.ended=!0})),this.vmPlayer.on("volumechange",(e=>{this._vimeoState.volume=e})),this.vmPlayer.on("error",(e=>{this.trigger("error",e)})),this.triggerReady(),r.debug("\ncreated "+this.name_+" player on ID: "+this.el_.firstChild.id)}initVimeoState(){var s=this._vimeoState={ended:!1,playing:!1,muted:!1,volume:0,progress:{seconds:0,percent:0,duration:0}};this.vmPlayer.getCurrentTime().then((e=>s.progress.seconds=e)),this.vmPlayer.getDuration().then((e=>s.progress.duration=e)),this.vmPlayer.getPaused().then((e=>s.playing=!e)),this.vmPlayer.getVolume().then((e=>s.volume=e)),t=e(this.options_.playerId),i=document.getElementsByClassName("vjs-big-play-button");for(var a=0;a<i.length;a++){i[a].parentElement.player.controls_||t.player_.el_.classList.remove("vjs-controls-disabled")}}createEl(){t=e(this.options_.playerId);var i=document.createElement("div");i.setAttribute("id",this.options_.techId),i.setAttribute("style","width:100%; height:100%; top:0; left:0; position:absolute"),i.setAttribute("class","vjs-tech");var s=document.createElement("div");s.setAttribute("class","vjs-tech-wrapper"),s.appendChild(i);var a=document.createElement("div");return a.setAttribute("class","vjs-tech-overlay"),a.setAttribute("style","cursor: pointer; position:absolute; z-index: 1; top:0; left:0; width:100%; height:100%"),s.appendChild(a),a.addEventListener("click",(e=>{this._vimeoState.playing||(t.player_.el_.classList.add("vjs-controls-disabled"),this.vmPlayer.play(),this.trigger("play"),this._vimeoState.playing=!0),a.remove()}),{once:!0}),s}controls(){return!0}supportsFullScreen(){return!0}src(){return this.options_.source}currentSrc(){return this.options_.source.src}volume(){this.vmPlayer.getVolume().then((e=>e)).catch((e=>{}))}setVolume(e){this.vmPlayer.setVolume(e).then((e=>(this.trigger("volumechange"),e))).catch((e=>{e.name}))}muted(){e(this.options_.playerId);this.vmPlayer.getMuted().then((e=>{})).catch((e=>{}))}setMuted(t){e(this.options_.playerId);var i=!this._vimeoState.muted,s=this;this.vmPlayer.setMuted(i).then((e=>{s._vimeoState.muted=e})).catch((e=>{}))}buffered(){const t=this._vimeoState.progress;return e.time.createTimeRanges(0,t.percent*t.duration)}paused(){return!this._vimeoState.playing}pause(){this.vmPlayer.pause(),this._vimeoState.playing=!1}play(){t.player_.el_.classList.add("vjs-controls-disabled"),this.vmPlayer.play(),this._vimeoState.playing=!0}ended(){return this._vimeoState.ended}currentTime(){this.vmPlayer.getCurrentTime().then((e=>e)).catch((e=>{}))}setCurrentTime(e){this.lastState===vmPlayer.getPaused()&&(this.timeBeforeSeek=this.currentTime()),this.isSeeking||(this.wasPausedBeforeSeek=this.paused()),this.vmPlayer.seekTo(e,!0),this.trigger("timeupdate"),this.trigger("seeking"),this.isSeeking=!0,this.lastState===vmPlayer.getPaused()&&this.timeBeforeSeek!==e&&(clearInterval(this.checkSeekedInPauseInterval),this.checkSeekedInPauseInterval=setInterval(function(){this.lastState===vmPlayer.getPaused()&&this.isSeeking?this.currentTime()!==this.timeBeforeSeek&&(this.trigger("timeupdate"),this.onSeeked()):clearInterval(this.checkSeekedInPauseInterval)}.bind(this),250))}seeking(){return this.isSeeking}seekable(){return this.vmPlayer?e.time.createTimeRanges(0,this.vmPlayer.getDuration()):e.time.createTimeRanges()}onSeeked(){clearInterval(this.checkSeekedInPauseInterval),this.isSeeking=!1,this.wasPausedBeforeSeek&&this.pause(),this.trigger("seeked")}playbackRate(){return this.vmPlayer?this.vmPlayer.getPlaybackRate():1}setPlaybackRate(e){this.vmPlayer&&this.vmPlayer.setPlaybackRate(e)}duration(){this.vmPlayer.getDuration().then((e=>e)).catch((e=>{}))}}function h(){d.isSdkReady=!0;for(var e=0;e<d.sdkReadyQueue.length;++e)d.sdkReadyQueue[e].initVMPlayer();r.debug("\ncreated all players from queue: #"+e),a=Date.now(),r.debug("\ninitializing plugin: finished"),r.debug("\nplugin initializing time: "+(a-s)+"ms")}d.prototype.featuresTimeupdateEvents=!0,d.isSupported=()=>!0,n.withSourceHandlers(d),d.nativeSourceHandler={},d.nativeSourceHandler.canPlayType=e=>{if("video/vimeo"===e)return"maybe"},d.nativeSourceHandler.canHandleSource=e=>e.type?d.nativeSourceHandler.canPlayType(e.type):e.src?d.nativeSourceHandler.canPlayType(e.src):void 0,d.nativeSourceHandler.handleSource=(e,t)=>{t.src(e.src)},d.nativeSourceHandler.dispose=()=>{},d.registerSourceHandler(d.nativeSourceHandler),d.VERSION="1.0.0",d.sdkReadyQueue=[];var p=setInterval((()=>{var t="block"===$("#content").css("display"),i="finished"===j1.getState(),a="finished"==j1.adapter.attic.getState();i&&t&&a&&(s=Date.now(),r.debug("\ninitializing plugin: started"),r.debug("\nversion of videoJS detected: "+e.VERSION),function(e,t){var i=!1,s=document.createElement("script"),a=document.getElementsByTagName("script")[0];a&&(a.parentNode.insertBefore(s,a),s.onload=()=>{i||(i=!0,t())},s.onreadystatechange=()=>{i||"complete"!==this.readyState&&"loaded"!==this.readyState||(i=!0,t())},s.src=e)}("/assets/themes/j1/modules/videojs/js/plugins/vm/api/vimeo.js",h),function(){if(l)return;l=!0;const e="\n        .vjs-vimeo iframe {\n          position: absolute;\n          top: 0;\n          left: 0;\n          width: 100%;\n          height: 100%;\n        }\n\n        .vjs-vimeo-mobile .vjs-big-play-button { display: none; }\n\n        video::-webkit-media-controls-panel { display: none !important; opacity: 0 !important; }\n        video::-webkit-media-controls-start-playback-button { display: flex !important; opacity: 1 !important; }\n\n        .player.hide-controls-mode video::-webkit-media-controls-play-button { display: none !important; }\n        .player .vp-video-wrapper .vp-telecine.hide-webkit-controls video::-webkit-media-controls-play-button { display: none !important; }\n        .player .vp-video-wrapper .vp-telecine.hide-webkit-controls video::-webkit-media-controls-play-button { display: none !important; }\n        .player .vp-video-wrapper .vp-telecine.hide-webkit-controls video::-webkit-media-controls-start-playback-button { display: none !important; }\n      ",t=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css",i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e)),r.debug("\nadded additional CSS styles"),t.appendChild(i)}(),clearInterval(p))}),10);void 0!==e.registerTech?e.registerTech("Vimeo",d):console.error("\ninvalid version of videoJS detected: "+e.VERSION)}));
